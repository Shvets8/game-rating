<script>
  const STORAGE_KEY = "gameRatings";

  function getVal(id) {
    return document.getElementById(id).value.trim();
  }

  function saveToStorage(data) {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
  }

  function loadFromStorage() {
    const raw = localStorage.getItem(STORAGE_KEY);
    return raw ? JSON.parse(raw) : [];
  }

  function renderGames(games) {
    const container = document.getElementById("gameList");
    container.innerHTML = "<h2>üóÇ –ü—Ä–æ–π–¥–µ–Ω–Ω—ã–µ –∏–≥—Ä—ã</h2>";
    games.forEach((game, index) => {
      const entry = document.createElement("div");
      entry.className = "game-entry";
      entry.innerHTML = `
        <h3>${game.title} (${game.date})</h3>
        <p><strong>–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞:</strong> ${game.platform} | <strong>–í—Ä–µ–º—è:</strong> ${game.time} —á | <strong>–°—Ç—Ä–∏–º:</strong> ${game.streamed} | <strong>–°—Ä–µ–¥–Ω—è—è –æ—Ü–µ–Ω–∫–∞:</strong> ${game.avg}/10</p>
        <details>
          <summary>–ü–æ–∫–∞–∑–∞—Ç—å –æ—Ü–µ–Ω–∫–∏</summary>
          <ul>
            <li>–°—é–∂–µ—Ç: ${game.scores[0]}</li>
            <li>–ê–∫—Ç—ë—Ä—Å–∫–∞—è –∏–≥—Ä–∞: ${game.scores[1]}</li>
            <li>–ó–≤—É–∫: ${game.scores[2]}</li>
            <li>–ì—Ä–∞—Ñ–∏–∫–∞: ${game.scores[3]}</li>
            <li>–ê–Ω–∏–º–∞—Ü–∏–∏: ${game.scores[4]}</li>
            <li>–ì–µ–π–º–ø–ª–µ–π: ${game.scores[5]}</li>
            <li>–ú–∏—Ä –∏ –ª–æ—Ä: ${game.scores[6]}</li>
            <li>–†–µ–∂–∏—Å—Å—É—Ä–∞: ${game.scores[7]}</li>
            <li>–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è: ${game.scores[8]}</li>
            <li>–û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ—Å—Ç—å: ${game.scores[9]}</li>
          </ul>
        </details>
        <p><em>${game.comment}</em></p>
        <button onclick="deleteGame(${index})">‚ùå –£–¥–∞–ª–∏—Ç—å</button>
        <button onclick="editGame(${index})">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
        <hr>
      `;
      container.appendChild(entry);
    });
  }

  function getFormData() {
    const scores = [
      "scoreStory", "scoreActing", "scoreSound", "scoreGraphics",
      "scoreAnimation", "scoreGameplay", "scoreWorld",
      "scoreDirecting", "scoreBugs", "scoreOriginality"
    ].map(id => parseFloat(getVal(id)) || 0);

    const avg = (scores.reduce((a, b) => a + b, 0) / scores.length).toFixed(1);

    return {
      title: getVal("gameTitle"),
      date: getVal("gameDate"),
      platform: getVal("gamePlatform"),
      time: getVal("gameTime"),
      streamed: getVal("gameStreamed"),
      scores: scores,
      avg: avg,
      comment: getVal("gameComment")
    };
  }

  function fillForm(data) {
    document.getElementById("gameTitle").value = data.title;
    document.getElementById("gameDate").value = data.date;
    document.getElementById("gamePlatform").value = data.platform;
    document.getElementById("gameTime").value = data.time;
    document.getElementById("gameStreamed").value = data.streamed;
    document.getElementById("gameComment").value = data.comment;

    const scoreIds = [
      "scoreStory", "scoreActing", "scoreSound", "scoreGraphics",
      "scoreAnimation", "scoreGameplay", "scoreWorld",
      "scoreDirecting", "scoreBugs", "scoreOriginality"
    ];

    scoreIds.forEach((id, i) => {
      document.getElementById(id).value = data.scores[i];
    });
  }

  let editIndex = -1;

  function addGame() {
    const allGames = loadFromStorage();
    const newGame = getFormData();

    if (editIndex >= 0) {
      allGames[editIndex] = newGame;
      editIndex = -1;
    } else {
      allGames.push(newGame);
    }

    saveToStorage(allGames);
    renderGames(allGames);
    document.querySelector(".game-form").reset();
  }

  function deleteGame(index) {
    const allGames = loadFromStorage();
    allGames.splice(index, 1);
    saveToStorage(allGames);
    renderGames(allGames);
  }

  function editGame(index) {
    const allGames = loadFromStorage();
    const game = allGames[index];
    fillForm(game);
    editIndex = index;
    window.scrollTo({ top: 0, behavior: "smooth" });
  }

  window.onload = () => {
    const stored = loadFromStorage();
    renderGames(stored);
  };
</script>
